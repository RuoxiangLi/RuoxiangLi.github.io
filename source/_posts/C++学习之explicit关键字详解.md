---
title: C++学习之explicit关键字详解
date: 2018-05-09 10:58:38
tags:
  - C++
  - explicit
categories: C++
---

-----

### 作用和使用方法

`explicit`关键字可以阻止不应该允许的经过转换函数进行的隐式转换的发生，声明为`explicit`的构造函数不能在隐式转换中使用。

`explicit`关键字只能用于修饰只有一个参数的类构造函数，它的作用是表明该构造函数是显式的，而非隐式的，跟它相对应的另一个关键字是`implicit`，意思是隐藏的，类构造函数默认情况下即声明为`implicit`(隐式)。

*注意：当类的声明和定义分别在两个文件中时，explicit只能写在在声明中，不能写在定义中。*

<!--more--->

### 理解

由于在C++中， 一个参数的构造函数(或者除了第一个参数外其余参数都有默认值的多参构造函数)， 承担了两个角色。一 是构造；二是默认且隐含的类型转换操作符。所以，如果写下如`AAA = XXX`这样的代码， 且恰好`XXX`的类型正好是`AAA`单参数构造器（构造函数）的参数类型， 这时候编译器就自动调用这个构造器， 创建一个`AAA`的对象。这种隐式转换在某些情况下， 违背了程序员的本意。 这就要在该构造器前加上`explicit`修饰， 指定该构造器只能被明确的调用/使用， 不能作为类型转换操作符被隐含的使用。

示例程序：

~~~c++
#include <iostream>  
using namespace std;  
class Test1  
{  
public :  
    Test1(int num):n(num){}  
private:  
    int n;  
};  
class Test2  
{  
 public :  
    explicit Test2(int num):n(num){}  
 private:  
    int n;  
};  

int main()  
{  
    Test1 t1 = 12;  //1 通过
    Test2 t2(13);   //2 通过
    Test2 t3 = 14;  //3 此行会编译错误，提示：无法从“int”转换为“Test2”

    return 0;  
}  
~~~

1处编译通过，是因为C++中，如果构造函数只有一个参数，在编译时就会有一个缺省的转换操作：将该构造函数对应数据类型的数据转换为该类对象。也就是说 `Test1 t1 = 12;`这段代码，编译器自动将整型转换为`Test1`类对象，实际上等同于下面的操作：

~~~c++
Test1 t1(12);
~~~

或者：

~~~c++
Test1 temp(12);
Test1 t1 = temp;
~~~

3处编译不通过，就是因为`Test3`类的定义中，构造函数前面加了`explicit`关键字，阻止了类构造函数的隐式自动转换。



参考连接：http://www.cnblogs.com/ymy124/p/3632634.html